<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€²åº¦æŸ¥è©¢</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .detail-card {
      background: #fdfdfd;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      font-size: 15px;
      line-height: 1.6;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .detail-card p { margin: 8px 0; }
    .detail-card b { color: #333; }

    /* JSON å€å¡Šï¼ˆDebugï¼‰ */
    #debugJson {
      background:#1e1e1e;
      color:#d4d4d4;
      padding:15px;
      margin-top:15px;
      border-radius:6px;
      font-family: "Courier New", monospace;
      font-size:14px;
      line-height:1.5;
      overflow-x:auto;
      white-space:pre-wrap;
      box-shadow:inset 0 0 5px rgba(0,0,0,0.3);
      text-align:left;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>åºåˆ—è™Ÿé€²åº¦æŸ¥è©¢</h2>
    <label>è¼¸å…¥åºåˆ—è™Ÿ
      <input type="text" id="serialInput" placeholder="ä¾‹å¦‚ï¼šA250828145933123">
    </label>
    <button class="btn-query" onclick="checkSerial()">æŸ¥è©¢é€²åº¦</button>

    <!-- ç‹€æ…‹æç¤º -->
    <div id="queryResult"></div>

    <!-- å¯è®€è³‡è¨Šï¼ˆçµ¦ä½¿ç”¨è€…çœ‹ï¼‰ -->
    <div id="detailBox" class="detail-card" style="display:none;"></div>

    <!-- JSON åŸå§‹å…§å®¹ï¼ˆçµ¦ Debugï¼‰ -->
   <pre id="debugJson" style="display:none;">{}</pre>


    <div class="back"><a href="index.html">â† è¿”å›å…¥å£</a></div>
  </div>


  
<script>
function formatDate(dateStr) {
  if (!dateStr) return "";
  const d = new Date(dateStr);
  if (isNaN(d)) return dateStr; // å¦‚æœä¸æ˜¯åˆæ³•æ—¥æœŸå°±åŸæ¨£é¡¯ç¤º
  return d.getFullYear() + "-" +
         String(d.getMonth() + 1).padStart(2, "0") + "-" +
         String(d.getDate()).padStart(2, "0");
}

  
  const GAS_URL = "https://script.google.com/macros/s/AKfycbxK_4aX7MS9m6vJKiX8xLvJFGf5DMMG6oVydnbaM-HZBD2DzwAa3ULd-JlSgrabWzY2LA/exec";

  function checkSerial(){
    const serial = document.getElementById("serialInput").value.trim();
    const box = document.getElementById("queryResult");
    const detailBox = document.getElementById("detailBox");
    const debugBox = document.getElementById("debugJson");

    if(!serial){
      box.textContent = "è«‹è¼¸å…¥åºåˆ—è™Ÿ";
      box.className = "status-error show";
      detailBox.style.display = "none";
      debugBox.textContent = "{}";
      return;
    }

    fetch(GAS_URL + "?serial=" + encodeURIComponent(serial))
      .then(res => res.json())
      .then(data => {
        // JSON Debug
        debugBox.textContent = JSON.stringify(data, null, 2);

        // é è¨­ä¸é¡¯ç¤ºå¡ç‰‡
        detailBox.style.display = "none";
        detailBox.innerHTML = "";

        if(data.success){
          // ç‹€æ…‹æç¤º
          if(data.status === "ç”³è«‹ä¸­"){
            box.textContent = "â³ ç”³è«‹ä¸­";
            box.className = "status-pending show";
          } else if(data.status === "å·²æ ¸å‡†"){
            box.textContent = "âœ… å·²æ ¸å‡†";
            box.className = "status-approved show";
          }

          // å“é …å…§å®¹ï¼ˆæˆªæ–· 8 å­—ï¼‰
          let shortItem = data.item.length > 8 ? data.item.slice(0,8) + "â€¦" : data.item;
          let displayItem = data.brand ? `${data.brand} ${shortItem}` : shortItem;

          // ä¸»è¦é¡¯ç¤ºå¡ç‰‡
          let html = `
            <p>ğŸ“Œ <b>åºåˆ—è™Ÿï¼š</b>${data.serial}</p>
            <p>ğŸ¢ <b>ç”³è«‹å–®ä½ï¼š</b>${data.unit}</p>
            <p>ğŸ“… <b>ç”³è«‹æ—¥æœŸï¼š</b>${formatDate(data.date)}</p>
            <p>ğŸ›’ <b>å“é …å…§å®¹ï¼š</b>${displayItem}</p>
            <details>
              <summary>ğŸ”½ å±•é–‹ç´°é …</summary>
              <p>â€¢ å“é …å…§å®¹ï¼š${data.item}</p>
              <p>â€¢ è¦æ ¼ï¼š${data.spec}</p>
              <p>â€¢ å–®ä½ï¼š${data.unitType}</p>
            </details>
          `;

          detailBox.innerHTML = html;
          detailBox.style.display = "block";
        } else {
          box.textContent = data.display || "âŒ æŸ¥ç„¡æ­¤åºåˆ—è™Ÿ";
          box.className = "status-error show";
        }
      })
      .catch(err => {
        box.textContent = "âš ï¸ ç³»çµ±ç™¼ç”ŸéŒ¯èª¤";
        box.className = "status-error show";
        detailBox.style.display = "none";
        debugBox.textContent = "{}";
      });
  }
</script>
</body>
</html>
