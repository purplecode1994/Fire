<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>進度查詢</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .detail-card {
      background: #fdfdfd;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      font-size: 15px;
      line-height: 1.6;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .detail-card p { margin: 8px 0; }
    .detail-card b { color: #333; }

    /* JSON 區塊 */
    #debugJson {
      background:#1e1e1e;
      color:#d4d4d4;
      padding:15px;
      margin-top:15px;
      border-radius:6px;
      font-family: "Courier New", monospace;
      font-size:14px;
      line-height:1.5;
      overflow-x:auto;
      white-space:pre-wrap;
      box-shadow:inset 0 0 5px rgba(0,0,0,0.3);
      text-align:left;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>序列號進度查詢</h2>
    <label>輸入序列號
      <input type="text" id="serialInput" placeholder="例如：A250828145933123">
    </label>
    <button class="btn-query" onclick="checkSerial()">查詢進度</button>

    <!-- 狀態提示 -->
    <div id="queryResult"></div>

    <!-- 可讀資訊（給使用者看） -->
    <div id="detailBox" class="detail-card" style="display:none;"></div>

    <!-- JSON 原始內容（給 Debug） -->
    <pre id="debugJson">{}</pre>

    <div class="back"><a href="index.html">← 返回入口</a></div>
  </div>

<script>
  // ⚠️ 改成你最新部署的 GAS doGet exec URL
  const GAS_URL = "https://script.google.com/macros/s/AKfycbwgM8kJhScg79NL3EQCoooAjpyB4UjrTzcAN5rMnqCvnPQJWzY-2VREABWnI_e8dr3C_w/exec";

  function checkSerial(){
    const serial = document.getElementById("serialInput").value.trim();
    const box = document.getElementById("queryResult");
    const detailBox = document.getElementById("detailBox");
    const debugBox = document.getElementById("debugJson");

    if(!serial){
      box.textContent = "請輸入序列號";
      box.className = "status-error show";
      detailBox.style.display = "none";
      debugBox.textContent = "{}";
      return;
    }

    fetch(GAS_URL + "?serial=" + encodeURIComponent(serial))
      .then(res => res.json())
      .then(data => {
        // 更新 JSON 區塊（完整原始回傳）
        debugBox.textContent = JSON.stringify(data, null, 2);

        // 預設不顯示卡片
        detailBox.style.display = "none";
        detailBox.innerHTML = "";

        if(data.display){
          // 使用 display 作為主要呈現文字
          box.textContent = data.status === "已核准" ? "✅ 已核准"
                        : data.status === "申請中" ? "⏳ 申請中"
                        : data.display;

          // 顯示卡片
          let html = data.display.replace(/\n/g, "<br>");
          detailBox.innerHTML = html;
          detailBox.style.display = "block";
        } else {
          box.textContent = "❌ 查無此序列號";
          box.className = "status-error show";
        }
      })
      .catch(err => {
        box.textContent = "⚠️ 系統發生錯誤";
        box.className = "status-error show";
        detailBox.style.display = "none";
        debugBox.textContent = "{}";
      });
  }
</script>
</body>
</html>